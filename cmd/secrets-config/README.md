% secrets-config-proxy(1) User Manuals secrets-config-proxy(1)

# NAME

secrets-config-proxy â€“ Configure EdgeX API gateway service

# SYNOPSIS

**secrets-config proxy** SUBCOMMAND [OPTIONS]

# DESCRIPTION

Configures the EdgeX API gateway service.

This command is used to configure the TLS certificate for external connections, create authentication tokens for inbound proxy access, and other related utility functions.

Proxy configuration commands (listed below) require access to the secret store master key in order to generate temporary secret store access credentials.

# OPTIONS

  * **--confdir** _/path/to/directory/with/configuration.toml_ (optional)

    Points to directory containing a configuration.toml file.

# SUBCOMMANDS

  * **tls**

    Configure inbound TLS certificate. This command will provision the TLS secrets into the secret store and re-deploy them to Kong. Requires additional arguments:

    * **--incert** _/path/to/certchain_ (required)

      Path to TLS leaf certificate (PEM-encoded x.509) (the file extension is arbitrary).
      If intermediate certificates are required to chain to a certificate authority,
      these should also be included.
      The root certificate authority should not be included.

    * **--inkey** _/path/to/private\_key_ (required)

      Path to TLS private key (PEM-encoded).

    * **--snis** _comma_separated_list_for_server_names_ (optional)

      A comma separated extra server DNS names in addition to the built-in
      server name indications.  The built-in names are &quot;localhost,kong&quot;.
      These names will be associated with the user-provided certificate for Kong's TLS to use.
      Based on the specification [RFC4366](https://tools.ietf.org/html/rfc4366):
      &quot;Currently, the only server names supported are DNS hostnames&quot;,
      so the IP address-based input is not allowed.

  * **adduser**

    Create an API gateway user using specified token type. Requires additional arguments:

    * **--token-type** jwt | oauth2 (required)
    
      Create user using either the JWT or OAuth2 authentication plugin.
      This value must match the configured authentication plugin
      (`KongAuth.Name` in security-proxy-setup's `configuration.toml`).

    * **--user** _username_ (required)

      Username of the user to add.

    * **--group** _group_ (optional)

      Group to which the user belongs, defaults to &quot;admin&quot;.
      This should be the group associated with the route ACL
      (`KongAuth.WhiteList` in security-proxy-setup's `configuration.toml`).
      (Note that secrets-config shares the same configuration as security-proxy-setup
      as they both configure the EdgeX API gateway.)


    The following options are used when token-type == "jwt":

    * **--algorithm** RS256 | ES256 (required for JWT method)

      Algorithm used for signing the JWT.
      (See [RFC 7518](https://tools.ietf.org/html/rfc7518#section-3.1) for a list of signing algorithms.)

    * **--public\_key** _/path/to/public\_key_ (required for JWT tokens)

      Public key (in PEM format) used to validate the JWT.
      (Not an x.509 certificate.)
      This key is assumed to have been pre-created using some external mechanism such as a TPM, HSM, openssl, or other method.

    * **--id** _key_ (optional)

      Optional user-specified &quot;key&quot; used for linkage with an incoming JWT via Kong&#39;s config.key\_claim\_name setting (defaults to &quot;iss&quot; field).
      See
      [Kong documentation for JWT plugin](https://docs.konghq.com/hub/kong-inc/jwt/#craft-a-jwt-with-publicprivate-keys-rs256-or-es256)
      for an example of how this parameter is used.

    Upon completion, for token-type == "jwt", the command outputs the autogenerated _key_ for the **id** command above.
    This value must be used during later construction of the JWT.


    The following options are used when token-type == "oauth2":

    * **--client\_id** (optional)

      Optional manually-specified OAuth2 client_id.  Will be generated if not present.  Equivalent to a username.

    * **--client\_secret** (optional)

      Optional manually-specified OAuth2 client_secret.  Will be generated if not present.  Equivalent to a password.

    * **--redirect\_uris** _url\_for\_browser\_redirection_ (optional)

      OAuth2 redirect URL for browser-based users. Defaults to "https://localhost".  This is not currently used by EdgeX but the API gateway requires a value.

    Upon completion, for token-type == "oauth2", the command outputs a JSON structure containing the client_id and client_secret.
    

  * **deluser**

    Delete a API gateway user. Requires additional arguments:

    * **--user** _username_ (required)

      Username of the user to delete.


  * **jwt**

    Utility function to create a JWT proxy authentication token from a supplied secret. This command does not require secret store access, but the values supplied must match those presented to the adduser command earlier. Requires additional arguments:

    * **--algorithm** `RS256` | `ES256` (required)

      Algorithm used for signing the JWT.
      (See [RFC 7518](https://tools.ietf.org/html/rfc7518#section-3.1) for a list of signing algorithms.)

    * **--id** _key_ (required)

      The &quot;key&quot; field from the &quot;adduser&quot; command.
      (This will be either the --id argument passed in, or the automatically generated identifier.)
      (This is not actually a cryptographic key, but a unique identifier such as would be used in a database.)

    * **--private\_key** _/path/to/private.key_ (required)

      Private key used to sign the JWT (PEM-encoded) with a key type corresponding to the above-supplied algorithm.

    * **--exp** _duration_ (optional)

      Duration of generated JWT expressed as a golang-parseable duration value. Use &quot;never&quot; to omit an expiration field in the JWT. Defaults to &quot;1h&quot; (one hour) if unspecified.

    
    The generated JWT will be the encoded representation of:

      <pre>
      {
        &quot;typ&quot;: &quot;JWT&quot;,
        &quot;alg&quot;: &quot;RS256 | ES256&quot;
      }
      {
        &quot;iss&quot;: &quot;_key_&quot;,
        &quot;exp&quot;: (calculated expiration time)
      }
      (signature)
      </pre>


  * **oauth2**

    Utility function to create an OAuth2 proxy authentication token using the client_credentials OAuth2 grant flow. This command does not require secret store access, but the values supplied must match those presented to the adduser command earlier. Requires additional arguments:

    * **--client\_id** _client\_id_ (required)

      OAuth2 client_id from previous "adduser" command.  Equivalent to a username.

    * **--client\_secret** _client\_secret_ (required)

      OAuth2 client_secret from previous "adduser" command.  Equivalent to a password.



# CONFIGURATION

# ENVIRONMENT

  * **IKM\_HOOK**

    Enables decryption of an encrypted secret store master key by pointing at an executable that returns an encryption seed that is formatted as a hex-encoded (typically 32-byte) string to its stdout.
    This optional feature, if enabled, requires pointing at the same executable that was used
    by security-secretstore-setup to provision and unlock the EdgeX the secret store.

# SEE ALSO

secrets-config(1)

EdgeX Foundry Last change: 2020
